<section class="howit-grid howit-b" aria-label="How it works – Variant B">
  <article class="panel">
    <header class="panel-h">
      <div>
        <div class="kicker">FIELD RITUAL LOOP</div>
        <div class="sub">Scrub the phase. See which rail is active.</div>
      </div>

      <div class="scrub">
        <span class="scrub-l">t</span>
        <input id="scrubB" type="range" min="0" max="2" step="1" value="0" aria-label="Scrub epoch phase"/>
        <span class="scrub-r">t+2</span>
      </div>
    </header>

    <div class="loop-wrap">
      <div class="loop-visual">
        <svg viewBox="0 0 420 420" class="loop-svg" aria-label="Concentric loop scrub">
          <defs>
            <filter id="glowYellowB" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur stdDeviation="3.5" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>

          <circle cx="210" cy="210" r="160" class="ring-base"/>
          <circle cx="210" cy="210" r="128" class="ring-base"/>
          <circle cx="210" cy="210" r="96"  class="ring-base"/>

          <g id="sigB"><circle cx="210" cy="210" r="160" class="ring-seg ring-sig" filter="url(#glowYellowB)"/></g>
          <g id="attB"><circle cx="210" cy="210" r="128" class="ring-seg ring-att" filter="url(#glowYellowB)"/></g>
          <g id="clmB"><circle cx="210" cy="210" r="96" class="ring-seg ring-claimB"/></g>

          <circle cx="210" cy="210" r="64" class="core"/>
          <text x="210" y="222" text-anchor="middle" class="omega">Ω</text>
          <text x="210" y="252" text-anchor="middle" class="core-label">FIELD</text>
        </svg>
      </div>

      <div class="epoch-row" id="epochRowB">
        <div class="epoch-card" data-step="0">
          <div class="epoch-top"><span class="epoch-tag">Epoch t</span><span class="epoch-rail">Signals</span></div>
          <div class="epoch-body">Intent + timing. Structure only.</div>
        </div>
        <div class="epoch-card" data-step="1">
          <div class="epoch-top"><span class="epoch-tag">Epoch t+1</span><span class="epoch-rail">Attests</span></div>
          <div class="epoch-body">Attest a closed target (no self-attest).</div>
        </div>
        <div class="epoch-card" data-step="2">
          <div class="epoch-top"><span class="epoch-tag">Epoch t+2</span><span class="epoch-rail">Claims</span></div>
          <div class="epoch-body">Settlement completes. Claims appear.</div>
        </div>
      </div>
    </div>
  </article>

  <!-- Personal Presence carousel (reuse exact carousel styles from A if already present) -->
  <article class="panel">
    <header class="panel-h">
      <div>
        <div class="kicker">PERSONAL PRESENCE</div>
        <div class="sub">Swipe the objects. Click artefact to open.</div>
      </div>
    </header>

    <div class="carousel-controls">
      <div class="carousel-dots" id="ppDotsB" aria-label="Personal presence navigation"></div>
    </div>

    <section class="carousel" id="ppCarouselB" aria-label="Personal presence carousel">
      <div class="carousel-track">
        <article class="carousel-slide">
          <div class="slide-inner">
            <div>
              <div class="slide-label">Key (Mint)</div>
              <div class="slide-name">Glyph-name</div>
              <div class="slide-tag">Permanent sequence</div>
              <p class="slide-body">Your glyph line is your stable signature.</p>
            </div>
            <div class="pp-frame">
              <div class="pp-glyphline">◇ · ∞ · ☰ · ⟡ · △ · ○</div>
              <div class="pp-note">soulbound</div>
            </div>
          </div>
        </article>

        <article class="carousel-slide">
          <div class="slide-inner">
            <div>
              <div class="slide-label">Artefacts</div>
              <div class="slide-name">Mirror preview</div>
              <div class="slide-tag">Click to open</div>
              <p class="slide-body">Rendered patterns, not raw text.</p>
              <a class="cta-link" href="artefacts.html">Open artefacts →</a>
            </div>
            <a class="pp-frame pp-click" href="artefacts.html">
              <svg viewBox="0 0 240 320" class="mini-artefact" role="img" aria-label="Artefact preview">
                <defs>
                  <linearGradient id="miniBorderB" x1="0" y1="0" x2="1" y2="0">
                    <stop offset="0" stop-color="#66D69A"/>
                    <stop offset="1" stop-color="#F06292"/>
                  </linearGradient>
                </defs>
                <rect x="10" y="10" width="220" height="300" rx="20" fill="none" stroke="url(#miniBorderB)" stroke-width="10"/>
                <rect x="18" y="18" width="204" height="284" rx="16" fill="#0f141f"/>
                <text x="120" y="62" text-anchor="middle" fill="#f8f6ee" font-size="14">Z1N #2100</text>
                <text x="120" y="92" text-anchor="middle" fill="#fff" font-size="18" font-weight="700">∞ · π · △ · ⊗</text>
                <circle cx="120" cy="170" r="52" fill="#141b28" stroke="rgba(148,163,184,0.25)"/>
                <text x="120" y="176" text-anchor="middle" fill="#f5c842" font-size="14" font-weight="700">ΩK 42%</text>
              </svg>
            </a>
          </div>
        </article>

        <article class="carousel-slide">
          <div class="slide-inner">
            <div>
              <div class="slide-label">Canon Anchors</div>
              <div class="slide-name">Purple stamp</div>
              <div class="slide-tag">Permanent on-chain marker</div>
              <p class="slide-body">A ritual declaration: “this epoch mattered.”</p>
            </div>
            <div class="pp-frame canon-frame">
              <div class="canon-omega">Ω</div>
              <div class="pp-note" style="color: rgba(168,85,247,0.9);">canon anchor</div>
            </div>
          </div>
        </article>

      </div>
    </section>
  </article>
</section>

<style>
  /* add-on for B only (reuses most styles from A if already loaded) */
  .scrub{
    display:flex; align-items:center; gap:10px;
    padding: 8px 10px;
    border-radius: 999px;
    border: 1px solid rgba(245,200,66,0.25);
    background: rgba(245,200,66,0.06);
  }
  .scrub-l,.scrub-r{ font-size:12px; color: rgba(255,255,255,0.85); }
  #scrubB{ width:140px; accent-color: var(--y); }

  .ring-claimB{
    fill:none;
    stroke: rgba(245,200,66,0.95);
    stroke-width: 14;
    stroke-linecap: round;
    stroke-dasharray: 96 220;     /* “claim segment” only */
    stroke-dashoffset: -240;
    opacity: 0.25;
  }
  .canon-omega{
    font-size:56px;
    font-weight:900;
    color: var(--p);
    text-align:center;
    text-shadow: 0 0 18px rgba(168,85,247,0.45);
    line-height: 1;
    margin-top: 26px;
  }
</style>

<script>
(function(){
  // Scrub sets phase: 0=t, 1=t+1, 2=t+2
  const input = document.getElementById("scrubB");
  const row = document.getElementById("epochRowB");
  const cards = row ? Array.from(row.querySelectorAll(".epoch-card")) : [];

  const sig = document.getElementById("sigB");
  const att = document.getElementById("attB");
  const clm = document.getElementById("clmB");

  function setStep(step){
    cards.forEach(c => c.classList.toggle("active", Number(c.dataset.step) === step));

    // rotate rings to “point” at the active segment
    // 3 segments => 0deg, 120deg, 240deg
    const rot = step * 120;

    if(sig) sig.setAttribute("transform", `rotate(${rot} 210 210)`);
    if(att) att.setAttribute("transform", `rotate(${rot-120} 210 210)`); // attest lags one
    if(clm) clm.setAttribute("transform", `rotate(${rot-240} 210 210)`); // claims lags two
  }

  if(input){
    setStep(Number(input.value));
    input.addEventListener("input", ()=> setStep(Number(input.value)));
  }

  // Personal Presence carousel (B)
  const carousel = document.getElementById("ppCarouselB");
  if(!carousel) return;
  const track = carousel.querySelector(".carousel-track");
  const slides = Array.from(carousel.querySelectorAll(".carousel-slide"));
  const dots = document.getElementById("ppDotsB");
  let index = 0, total = slides.length;

  function buildDots(){
    dots.innerHTML = "";
    for(let i=0;i<total;i++){
      const b = document.createElement("button");
      b.className = "dot" + (i===0 ? " active" : "");
      b.type = "button";
      b.addEventListener("click", ()=>{ index=i; snap(); });
      dots.appendChild(b);
    }
  }
  function setActiveDot(){
    Array.from(dots.querySelectorAll(".dot")).forEach((d,i)=>d.classList.toggle("active", i===index));
  }
  function snap(){
    track.style.transition = "transform .45s ease";
    track.style.transform = "translateX(-" + (index*100) + "%)";
    setActiveDot();
  }

  // swipe
  let isDown=false, startX=0, lastX=0, dx=0;
  function down(x){ isDown=true; startX=x; lastX=x; dx=0; track.style.transition="none"; }
  function move(x){
    if(!isDown) return;
    lastX=x; dx=lastX-startX;
    const pct=(dx/carousel.clientWidth)*100;
    track.style.transform="translateX(calc(-"+(index*100)+"% + "+pct+"%))";
  }
  function up(){
    if(!isDown) return;
    isDown=false;
    const thr=carousel.clientWidth*0.18;
    if(dx>thr && index>0) index--;
    else if(dx<-thr && index<total-1) index++;
    snap();
  }

  carousel.addEventListener("pointerdown", e=>down(e.clientX));
  window.addEventListener("pointermove", e=>move(e.clientX));
  window.addEventListener("pointerup", up);
  window.addEventListener("pointercancel", up);
  carousel.addEventListener("dragstart", e=>e.preventDefault());

  buildDots(); snap();
})();
</script>
